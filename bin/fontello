#!/usr/bin/env ruby

require 'optparse'
require "fontello_rails_converter"
command = ARGV[0]

if ARGV[0].nil?
	puts "Run fontello --help for help"
	exit
end

options = {
	:asset_dir => "./",
	:stylesheet_dir => "./",
	:font_dir => "./",
	:zip_file => "./fontello.zip",
	:config_file => "./config.json"
}

OptionParser.new do |opts|
  opts.banner = "Usage: fontello [open|download|convert] -r /path/to/railsapp [override options]"

  opts.on("-r", "--rails-root [PATH]", "Rails root path\n\n") do |opt|
    options[:asset_dir] = "#{opt}/vendor/assets"
    options = {
      stylesheets_dir: "#{options[:asset_dir]}/stylesheets",
      font_dir: "#{options[:asset_dir]}/fonts",
      zip_file: "#{opt}/tmp/fontello.zip",
      config_file: "#{options[:asset_dir]}/fonts/config.json"
    }
  end

  opts.separator "Override options:"

	opts.on("-c", "--config [PATH]", "Config json file (default: /rails_root/vendor/assets/fonts/config.json)") do |opt|
		options[:config_file] = opt
	end

	opts.on("-i", "--input [PATH]", "Downloaded zip file (default: /rails_root/tmp/fontello.zip)") do |opt|
		options[:zip_file] = opt
	end

  opts.on("-a", "--asset-dir [PATH]", "Target asset directory (default: /rails_root/vendor/assets)") do |opt|
    options[:asset_dir] = opt
  end

  opts.on("-s", "--stylesheet-dir [PATH]", "Target stylesheet directory (default: /rails_root/vendor/assets/stylesheets)") do |opt|
    options[:stylesheet_dir] = opt
  end

  opts.on("-f", "--font-dir [PATH]", "Target font directory (default: /rails_root/vendor/assets/fonts)") do |opt|
    options[:font_dir] = opt
  end
end.parse!


unless ["open", "convert"].include?(command)
	puts "available commands: open, convert"
	exit
end

FontelloRailsConverter::Cli.new(options).send(command)

